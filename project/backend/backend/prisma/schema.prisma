// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id                String             @id @default(cuid())
  email             String             @unique
  name              String?
  password          String
  role              String             @default("USER")
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  
  // Relations
  exhibitAnalyses   ExhibitAnalysis[]
  tours            Tour[]
  
  @@map("users")
}

model AdminUser {
  id                String             @id @default(cuid())
  email             String             @unique
  password          String
  role              String             @default("ADMIN")
  isActive          Boolean            @default(true)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  
  @@map("admin_users")
}

model Exhibit {
  id                String             @id @default(cuid())
  name              String
  description       String?
  location          String?
  category          String?
  imageUrl          String?
  isActive          Boolean            @default(true)
  
  // Enhanced Data Sheet Fields
  exhibitCode       String?            // Unique exhibit identifier
  scientificName    String?            // Scientific classification if applicable
  ageRange          String?            // Target age group
  exhibitType       String?            // Interactive, Passive, Hands-on
  environment       String?            // Indoor, Outdoor, Both
  duration          Int?               // Estimated viewing time in minutes
  difficulty        String?            // Easy, Medium, Hard
  language          String?            // Primary language of display
  accessibility     String?            // Accessibility features
  maintenanceNotes  String?            // Maintenance and care instructions
  safetyNotes       String?            // Safety guidelines
  educationalValue  String?            // Learning objectives
  curriculumLinks   String?            // Links to educational curriculum
  materials         String?            // Materials used in exhibit
  dimensions        String?            // Physical dimensions
  weight            Float?             // Weight in kg
  powerRequirements String?            // Electrical requirements
  temperatureRange  String?            // Operating temperature range
  humidityRange     String?            // Operating humidity range
  lastMaintenance   DateTime?          // Last maintenance date
  nextMaintenance   DateTime?          // Next scheduled maintenance
  cost              Float?             // Exhibit cost
  sponsor           String?            // Sponsor information
  designer          String?            // Exhibit designer
  manufacturer      String?            // Manufacturer information
  warrantyExpiry    DateTime?          // Warranty expiration date
  insuranceInfo     String?            // Insurance information
  riskAssessment    String?            // Risk assessment details
  emergencyContact  String?            // Emergency contact information
  
  // Media and Features
  images            String?            // JSON array of image URLs
  videos            String?            // JSON array of video URLs
  audioGuides       String?            // JSON array of audio guide URLs
  interactiveFeatures String?          // JSON array of interactive features
  virtualTour       String?            // Virtual tour URL
  
  // Location and Mapping
  floor             String?            // Floor number/name
  coordinates       String?            // JSON object with x, y coordinates
  nearbyFacilities  String?            // JSON array of nearby facilities
  routeInstructions String?            // How to reach the exhibit
  
  // Analytics and Performance
  visitorCount      Int                @default(0)
  averageTime       Int                @default(0)  // Average time spent in minutes
  rating            Float              @default(0.0)
  feedbackCount     Int                @default(0)
  
  // Timestamps
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  
  // Relations
  tourExhibits      TourExhibit[]
  
  @@map("exhibits")
}

model Tour {
  id                String             @id @default(cuid())
  name              String
  description       String?
  duration          Int?               // in minutes
  difficulty        String             @default("EASY")
  isActive          Boolean            @default(true)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  
  // Relations
  userId            String
  user              User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  tourExhibits      TourExhibit[]
  
  @@map("tours")
}

model TourExhibit {
  id                String             @id @default(cuid())
  tourId            String
  exhibitId         String
  order             Int
  estimatedTime     Int?               // in minutes
  
  // Relations
  tour              Tour               @relation(fields: [tourId], references: [id], onDelete: Cascade)
  exhibit           Exhibit            @relation(fields: [exhibitId], references: [id], onDelete: Cascade)
  
  @@unique([tourId, exhibitId])
  @@map("tour_exhibits")
}

model VisitorAnalytics {
  id                String             @id @default(cuid())
  userId            String?
  page              String
  timeSpent         Int                // in seconds
  timestamp         DateTime           @default(now())
  userAgent         String?
  ipAddress         String?
  
  @@map("visitor_analytics")
}

model ExhibitAnalysis {
  id                  String   @id @default(cuid())
  userId              String
  originalText        String
  processedText       String
  confidence          Float
  processingTime      Int
  engineUsed          String
  imageMetadata       String   // JSON as string for SQLite
  preprocessingSteps  String   // JSON as string for SQLite
  languageZones       String   // JSON as string for SQLite
  detectedLanguages   String   // JSON as string for SQLite
  qualityScore        Float?
  trainingDataCollected Boolean @default(false)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("exhibit_analysis")
}

 